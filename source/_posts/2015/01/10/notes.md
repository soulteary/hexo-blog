---
title: "服务器回迁后的事情"
date: "2015-01-10 16:45:28"
tags: ["服务器迁移"]
---


服务器迁回HK有一两周了，访问状况看着不错。对于鸭梨访问的情况，有带宽/网卡/TENGINX/REDIS/HHVM的层层关卡下，可以保障机器MYSQL无虞。

从后台机器浏览看，大概经历了10次左右的网络流量峰值，不过DB没有什么异常。

回想起来，从SAE迁出之后，有好久没有使用过Object-Cache了，这次针对程序，单独写了一套缓存逻辑，带有一个有意思的小功能，“投币”，访客访问一段时间后，会根据情况添加缓存的生命周期，单个页面经历热点事件和被抓取的情况下，结果感人。

只可惜的是Redis不支持hsets中的key的expire，需要自己实现一套逻辑来维护sets中的key的过期。 

![结构摘要](http://attachment.soulteary.com/wp/2015/01/rdm.jpg)

![缓存状态](http://attachment.soulteary.com/wp/2015/01/redis-cache.jpg)

看了一下后台，内存缓存遮挡后的MySQL吞吐为每小时 2MB/10MB，配合当前主题，首页每次生成缓存，进行的SQL查询次数为9，而其他的页面进行的SQL查询次数为10。

至于前端，目前对于IE7~11，Chrome，FF，平板IE，Android && ios7支持良好。

而页面多数资源都有客户端缓存，接下来等项目做完了，给网站加上自动引用webp，和异步加载内容的功能好了。

至于是否重新备案，和把网站镜像到阿里云和加CDN，观望后在做处理吧。